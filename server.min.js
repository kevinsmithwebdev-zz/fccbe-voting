var express=require("express"),path=require("path"),cookieParser=require("cookie-parser"),bodyParser=require("body-parser"),exphbs=require("express-handlebars"),expressValidator=require("express-validator"),flash=require("connect-flash"),session=require("express-session"),passport=require("passport"),LocalStrategy=require("passport-local").Strategy,mongo=require("mongodb"),mongoose=require("mongoose");mongoose.connect("mongodb://localhost/BTloginapp",{useMongoClient:!0});
var db=mongoose.connection,routes=require("./routes/index"),users=require("./routes/users"),app=express();app.set("views",path.join(__dirname,"views"));app.engine("handlebars",exphbs({defaultLayout:"main"}));app.set("view engine","handlebars");app.use(bodyParser.json());app.use(bodyParser.urlencoded({extended:!1}));app.use(cookieParser());app.use(express["static"](path.join(__dirname,"public")));app.use(session({secret:"secret",saveUninitialized:!0,resave:!0}));app.use(passport.initialize());app.use(passport.session());
app.use(expressValidator({errorFormatter:function(a,b,c){a=a.split(".");for(var d=a.shift();a.length;)d+="["+a.shift()+"]";return{param:d,msg:b,value:c}}}));app.use(flash());app.use(function(a,b,c){b.locals.success_msg=a.flash("success_msg");b.locals.error_msg=a.flash("error_msg");b.locals.error=a.flash("error");b.locals.user=a.user||null;c()});app.use("/",routes);app.use("/users",users);app.set("port",process.env.PORT||3E3);
app.listen(app.get("port"),function(){console.log("\nServer started on port "+app.get("port")+"...")});
