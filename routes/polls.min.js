var express=require("express"),router=express.Router(),Poll=require("../models/poll");router.get("/new",function(a,b){console.log("inside GET polls/new");b.render("poll-new")});
router.post("/new",function(a,b){a.body.title=a.body.title.trim();a.body.choices=a.body.choices.map(function(a){return a.trim()}).filter(function(a,b,c){return a&&c.indexOf(a)==b});a.checkBody({title:{notEmpty:!0,errorMessage:"Invalid title"},choices:{enoughChoices:!0,errorMessage:"At least two unique choices are required"}});a.validationErrors();console.log("*** user");console.log(this);var c=new Poll({title:a.body.title,choices:a.body.choices.map(function(a){return{name:a,votes:0}},{}),creator:"wowsers",
voted:[]});console.log("*** new poll");console.log(c);Poll.createPoll(c,function(a,b){if(a)throw a;console.log(b)});a.flash("success_msg","Poll succesfully made");b.redirect("/")});module.exports=router;
